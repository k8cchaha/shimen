<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>水位查詢</title>

    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/app.css" rel="stylesheet">
    <!--[if lt IE 9]>
      <script src="lib/html5shiv.min.js"></script>
      <script src="lib/respond.min.js"></script>
    <![endif]-->
    <script src="lib/jquery.min.js"></script>
    <script src="lib/bootstrap.min.js"></script>
    <script src="lib/json2.js"></script>
	
	<link rel="stylesheet" href="css/jquery-ui.min.css" />
	<script src="lib/jquery-ui.min.js"></script>
	
	<script type="text/javascript">
		$(function() {
			$('#date').datepicker({dateFormat: 'yy-mm-dd', showOn: 'both', showOtherMonths: true, showWeeks: true, firstDay: 1, changeFirstDay: false, buttonImageOnly: true, buttonImage: 'image/calendar.gif'});
		});
		
		function ShowMeDate() {
			//alert(document.querySelector('#date').value);
			
			generate(document.querySelector('#date').value)
		};
		
		function generate(date) {
			var infoUrl = "db/waterLevel.php?id=-1&date=" + date;
			//alert(infoUrl);
			$("#loading").show();
			$.ajax({
	      		url: infoUrl,
				type: "GET",
				dataType: "json",
	      		success: function (response) {
					$("#infoTable").empty();
					//var json_data = {"hours":[{"InDate":"2016-05-02 01:00:00.000","hour_num":"1","minute_num":"0","Shemen":"244.05000000000001","Clouds":"294.11000000000001","High":"431.50999999999999","Angle":"531.64999999999998","Jade":"684.48000000000002","Show":"860.49000000000001","Kide":null},{"InDate":"2016-05-02 02:00:00.000","hour_num":"2","minute_num":"0","Shemen":"244.03999999999999","Clouds":"294.10000000000002","High":"431.5","Angle":"531.64999999999998","Jade":"684.48000000000002","Show":"860.49000000000001","Kide":null},{"InDate":"2016-05-02 03:00:00.000","hour_num":"3","minute_num":"0","Shemen":"244.03","Clouds":"294.10000000000002","High":"431.50999999999999","Angle":"531.64999999999998","Jade":"684.48000000000002","Show":"860.48000000000002","Kide":null},{"InDate":"2016-05-02 04:00:00.000","hour_num":"4","minute_num":"0","Shemen":"244.02000000000001","Clouds":"294.10000000000002","High":"431.5","Angle":"531.64999999999998","Jade":"684.47000000000003","Show":"860.48000000000002","Kide":null},{"InDate":"2016-05-02 05:00:00.000","hour_num":"5","minute_num":"0","Shemen":"244.02000000000001","Clouds":"294.07999999999998","High":"432.30000000000001","Angle":"531.64999999999998","Jade":"684.47000000000003","Show":"860.48000000000002","Kide":null},{"InDate":"2016-05-02 06:00:00.000","hour_num":"6","minute_num":"0","Shemen":"244.03","Clouds":"294.07999999999998","High":"432.14999999999998","Angle":"531.64999999999998","Jade":"684.47000000000003","Show":"860.48000000000002","Kide":null},{"InDate":"2016-05-02 07:00:00.000","hour_num":"7","minute_num":"0","Shemen":"244.03","Clouds":"294.06999999999999","High":"432.06999999999999","Angle":"531.64999999999998","Jade":"684.47000000000003","Show":"860.48000000000002","Kide":null},{"InDate":"2016-05-02 08:00:00.000","hour_num":"8","minute_num":"0","Shemen":"244.03","Clouds":"294.06999999999999","High":"431.89999999999998","Angle":"531.64999999999998","Jade":"684.47000000000003","Show":"860.47000000000003","Kide":null},{"InDate":"2016-05-02 09:00:00.000","hour_num":"9","minute_num":"0","Shemen":"244.03999999999999","Clouds":"294.06999999999999","High":"431.94","Angle":"531.64999999999998","Jade":"684.46000000000004","Show":"860.47000000000003","Kide":null},{"InDate":"2016-05-02 10:00:00.000","hour_num":"10","minute_num":"0","Shemen":"244.03999999999999","Clouds":"294.06999999999999","High":"431.88999999999999","Angle":"531.64999999999998","Jade":"684.47000000000003","Show":"860.47000000000003","Kide":"0.0"},{"InDate":"2016-05-02 11:00:00.000","hour_num":"11","minute_num":"0","Shemen":"244.03999999999999","Clouds":"294.06999999999999","High":"431.93000000000001","Angle":"531.63999999999999","Jade":"684.47000000000003","Show":"860.47000000000003","Kide":"0.0"},{"InDate":"2016-05-02 12:00:00.000","hour_num":"12","minute_num":"0","Shemen":"244.05000000000001","Clouds":"294.07999999999998","High":"431.89999999999998","Angle":"531.63","Jade":"684.46000000000004","Show":"860.47000000000003","Kide":"0.0"},{"InDate":"2016-05-02 13:00:00.000","hour_num":"13","minute_num":"0","Shemen":"244.03999999999999","Clouds":"294.06999999999999","High":"431.86000000000001","Angle":"531.63","Jade":"684.46000000000004","Show":"860.47000000000003","Kide":null},{"InDate":"2016-05-02 14:00:00.000","hour_num":"14","minute_num":"0","Shemen":"244.03999999999999","Clouds":"294.06999999999999","High":"431.77999999999997","Angle":"531.62","Jade":"684.46000000000004","Show":"860.47000000000003","Kide":"0.0"},{"InDate":"2016-05-02 15:00:00.000","hour_num":"15","minute_num":"0","Shemen":"244.03999999999999","Clouds":"294.06999999999999","High":"431.70999999999998","Angle":"531.62","Jade":"684.46000000000004","Show":"860.47000000000003","Kide":"0.0"},{"InDate":"2016-05-02 16:00:00.000","hour_num":"16","minute_num":"0","Shemen":"244.03","Clouds":"294.06999999999999","High":"431.51999999999998","Angle":"531.63","Jade":"684.46000000000004","Show":"860.46000000000004","Kide":"0.0"},{"InDate":"2016-05-02 17:00:00.000","hour_num":"17","minute_num":"0","Shemen":"244.03","Clouds":"294.06","High":"431.5","Angle":"531.63999999999999","Jade":"684.45000000000005","Show":"860.46000000000004","Kide":null},{"InDate":"2016-05-02 18:00:00.000","hour_num":"18","minute_num":"0","Shemen":"244.02000000000001","Clouds":"294.05000000000001","High":"431.50999999999999","Angle":"531.63999999999999","Jade":"684.45000000000005","Show":"860.46000000000004","Kide":null},{"InDate":"2016-05-02 19:00:00.000","hour_num":"19","minute_num":"0","Shemen":"244.00999999999999","Clouds":"294.05000000000001","High":"431.51999999999998","Angle":"531.64999999999998","Jade":"684.46000000000004","Show":"860.46000000000004","Kide":"0.0"},{"InDate":"2016-05-02 20:00:00.000","hour_num":"20","minute_num":"0","Shemen":"244.0","Clouds":"294.05000000000001","High":"431.5","Angle":"531.64999999999998","Jade":"684.45000000000005","Show":"860.46000000000004","Kide":null},{"InDate":"2016-05-02 21:00:00.000","hour_num":"21","minute_num":"0","Shemen":"243.99000000000001","Clouds":"294.05000000000001","High":"431.5","Angle":"531.64999999999998","Jade":"684.45000000000005","Show":"860.46000000000004","Kide":null}],"max":{"Shemen":"244.05000000000001","Clouds":"294.11000000000001","High":"432.30000000000001","Angle":"531.64999999999998","Jade":"684.48000000000002","Show":"860.49000000000001","Kide":"0.0"},"min":{"Shemen":"243.99000000000001","Clouds":"294.05000000000001","High":"431.5","Angle":"531.62","Jade":"684.45000000000005","Show":"860.46000000000004","Kide":"0.0"},"avg":{"Shemen":"244.02952380952385","Clouds":"294.07333333333338","High":"431.73809523809524","Angle":"531.642857142857","Jade":"684.46428571428567","Show":"860.47142857142808","Kide":"0.0"}};
					var json_data = response;
					var location = ["Shemen", "Clouds", "High", "Angle", "Jade", "Show"];
					var newLocation = ["Shemen", "Clouds", "High", "Angle", "Jade", "Show", "Kide"];
					var titleName = ["日期", "時間", "石門水庫", "霞雲", "高義", "稜角", "玉峰", "秀巒", "鳶山堰"];
					var info = "<table class='table table-striped table-bordered'><tbody>";
					info += "<tr class='active'>"
					for (var i = 0; i < titleName.length; i++) {
						info += "<td style='font-weight:bold;'>" + titleName[i]+ "</td>";
					}
					// each hours
					for (var i = 0; i < json_data["hours"].length; i++) {
						info += "<tr class='success'><td style='font-weight:bold'>" + json_data["hours"][i]["InDate"].substring(0, 10) + "</td><td style='font-weight:bold'>" + json_data["hours"][i]["hour_num"] + "</td>";
						for (var j = 0; j < location.length; j++) {
							info += "<td style='font-weight:bold;'>" + json_data["hours"][i][location[j]].substring(0, 6)+ "</td>";
						}
						if (!json_data["hours"][i]["Kide"]) {
							info += "<td style='font-weight:bold;'>****</td></tr>";
						} else {
							info += "<td style='font-weight:bold';>" + json_data["hours"][i]["Kide"] + "</td></tr>";
						}
					}
					
					// 水位
					info += "<tr class='success'><td style='font-weight:bold;'>最高水位</td><td></td>";
					for (var i = 0; i < newLocation.length; i++) {
						info += "<td style='font-weight:bold;'>" + json_data["max"][newLocation[i]].substring(0, 5) + "</td>";
					}
					info += "</tr>";
					
					info += "<tr class='success'><td style='font-weight:bold;'>最低水位</td><td></td>";
					for (var i = 0; i < newLocation.length; i++) {
						info += "<td style='font-weight:bold;'>" + json_data["min"][newLocation[i]].substring(0, 5) + "</td>";
					}
					info += "</tr>";
					
					info += "<tr><td style='font-weight:bold;'>平均水位</td><td></td>";
					for (var i = 0; i < newLocation.length; i++) {
						info += "<td style='font-weight:bold;'>" + json_data["avg"][newLocation[i]].substring(0, 5) + "</td>";
					}
					info += "</tr>";
					
					info += "</tbody></table>";
					$("#infoTable").append(info);
					
					$("#loading").hide();
	      		},
	        	error: function () {
	        		//alert("Error get!");
					$("#loading").hide();
	      		}
	  		});
		}
	</script>
  </head>
  <body>
	<script type="text/javascript"> 
	$(document).ready(function() {
			var myDate = new Date();
			var year = myDate.getFullYear();
			var month = myDate.getMonth() + 1;
			if(month <= 9)
				month = '0'+month;

			var day= myDate.getDate();
			if(day <= 9)
				day = '0'+day;

			var stamp = year +'-'+ month +'-'+ day;
			generate(stamp);
		});
	</script>	
	<div class="webHeader">
          <img src="image/banner.png"/>
    </div>
	
	<div class="queryData">
          日期：<input type="text" id="date"/>
		  <button type="button" class="btn btn-primary btn-sm" id="startQuery" onclick="ShowMeDate()">查詢</button>
    </div>
	單位: m
	<div class="loadingIcon" id="loading">
		<img src ='image/loading_icon.gif'/>
	</div>
	
	<div class="webHeader">
		<div id="infoTable">
		</div>
	</div>
  </body>
</html>